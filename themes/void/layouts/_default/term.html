{{ define "main" }}
<div class="tags-header">
  <div id="pagefind"></div>
  <div class="tag-cloud">
    {{ range .Site.Taxonomies.tags.Alphabetical }}
    {{ $isActive := eq .Page.Title $.Title }}
    <a href="{{ if $isActive }}{{ "tags/" | relURL }}{{ else }}{{ .Page.Permalink }}{{ end }}" class="tag{{ if $isActive }} active{{ end }}">{{ .Page.Title }}</a>
    {{ end }}
  </div>
</div>

<ul class="post-list">
  {{ $lastYear := "" }}
  {{ range .Pages }}
  {{ $year := .Date.Format "2006" }}
  {{ if ne $year $lastYear }}
  <li class="post-year">{{ $year }}</li>
  {{ $lastYear = $year }}
  {{ end }}
  <li class="post-item">
    <time class="post-date" datetime="{{ .Date.Format "2006-01-02" }}">
      {{ .Date.Format "01-02" }}
    </time>
    <span class="post-title">
      <a href="{{ .Permalink }}">{{ .Title }}</a>
    </span>
    {{ with .Params.tags }}
    <div class="post-tags">
      {{ range . }}<span class="tag">{{ . }}</span>{{ end }}
    </div>
    {{ end }}
  </li>
  {{ end }}
</ul>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    new PagefindUI({ element: "#pagefind", showSubResults: true });
    // 点击搜索框时跳转到 /tags/ 并自动 focus
    document.querySelector('#pagefind input')?.addEventListener('focus', () => {
      window.location.href = '/tags/?focus=1';
    });
  });
</script>
{{ end }}
